#!/bin/bash

# –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π —ñ–º–ø–æ—Ä—Ç –∫—ñ–ª—å–∫–æ—Ö —Ä–æ–∫—ñ–≤ –æ–¥–Ω–æ—á–∞—Å–Ω–æ

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ —ñ–º–ø–æ—Ä—Ç—É —Å—É–¥–æ–≤–∏—Ö —Ä—ñ—à–µ–Ω—å"

# –§—É–Ω–∫—Ü—ñ—è —ñ–º–ø–æ—Ä—Ç—É –æ–¥–Ω–æ–≥–æ —Ä–æ–∫—É
import_year() {
    local year=$1
    echo "üìÖ –ü–æ—á–∞—Ç–æ–∫ —ñ–º–ø–æ—Ä—Ç—É $year —Ä–æ–∫—É..."
    venv/bin/python manage.py import_court_decisions_fast --year $year --threads 4 --batch-size 20000 --chunk-size 100000
    echo "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ —ñ–º–ø–æ—Ä—Ç $year —Ä–æ–∫—É"
}

# –ó–∞–ø—É—Å–∫–∞—î–º–æ 3 –ø—Ä–æ—Ü–µ—Å–∏ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ
import_year 2021 &
PID1=$!

import_year 2020 &
PID2=$!

import_year 2019 &
PID3=$!

# –ß–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –ø–µ—Ä—à–æ—ó –≥—Ä—É–ø–∏
wait $PID1 $PID2 $PID3

echo "üèÅ –ü–µ—Ä—à–∞ –≥—Ä—É–ø–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (2019-2021)"

# –ó–∞–ø—É—Å–∫–∞—î–º–æ –¥—Ä—É–≥—É –≥—Ä—É–ø—É
import_year 2018 &
PID4=$!

import_year 2017 &
PID5=$!

import_year 2016 &
PID6=$!

# –ß–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –¥—Ä—É–≥–æ—ó –≥—Ä—É–ø–∏
wait $PID4 $PID5 $PID6

echo "üèÅ –î—Ä—É–≥–∞ –≥—Ä—É–ø–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ (2016-2018)"

# –ó–∞–ø—É—Å–∫–∞—î–º–æ —Ç—Ä–µ—Ç—é –≥—Ä—É–ø—É
import_year 2015 &
PID7=$!

import_year 2014 &
PID8=$!

# –ß–µ–∫–∞—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç—Ä–µ—Ç—å–æ—ó –≥—Ä—É–ø–∏
wait $PID7 $PID8

echo "üèÅ –í—Å—ñ —ñ–º–ø–æ—Ä—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!"

echo "üìä –°—Ç–≤–æ—Ä—é—î–º–æ –ø—ñ–¥—Å—É–º–∫–æ–≤—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É..."
venv/bin/python manage.py import_all_years --start-year 2014 --end-year 2014 --skip-existing